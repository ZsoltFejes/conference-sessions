<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Conference Session Saver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #020617;
      --card-bg: #0b1120;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --accent-strong: #0ea5e9;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #fb7185;
      --radius-lg: 16px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.85);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d4ed8 0, #020617 40%, #020617 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 24px;
    }

    .app-shell {
      max-width: 960px;
      width: 100%;
      background: linear-gradient(135deg, rgba(15,23,42,0.98), rgba(15,23,42,0.92));
      border-radius: 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.18);
      padding: 24px 24px 18px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      backdrop-filter: blur(18px);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .title-block {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-pill {
      width: 40px;
      height: 40px;
      border-radius: 18px;
      background: radial-gradient(circle at 20% 0, #38bdf8, #0f172a);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 30px rgba(56, 189, 248, 0.4);
      position: relative;
      overflow: hidden;
    }

    .logo-pill::before {
      content: "";
      position: absolute;
      inset: 0;
      background: conic-gradient(from 180deg, rgba(56,189,248,0.5), transparent 40%, rgba(56,189,248,0.6), transparent 75%);
      opacity: 0.3;
      mix-blend-mode: screen;
    }

    .logo-letter {
      position: relative;
      font-weight: 800;
      font-size: 20px;
    }

    h1 {
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h1 span.accent-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(56, 189, 248, 0.35);
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 0.7rem;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge strong {
      color: var(--text);
      font-weight: 600;
    }

    .tabs-container {
      margin-top: 8px;
      background: rgba(15, 23, 42, 0.8);
      border-radius: var(--radius-lg);
      padding: 6px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .tab-list {
      display: inline-flex;
      background: rgba(15, 23, 42, 0.7);
      border-radius: var(--radius-pill);
      padding: 4px;
      gap: 4px;
      position: relative;
      flex-shrink: 0;
    }

    .tab-list button {
      border: none;
      background: transparent;
      color: var(--muted);
      padding: 6px 16px;
      border-radius: var(--radius-pill);
      font-size: 0.8rem;
      cursor: pointer;
      position: relative;
      transition: color 0.16s ease, transform 0.16s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .tab-list button span.count-pill {
      font-size: 0.65rem;
      background: rgba(15, 23, 42, 0.92);
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--muted);
    }

    .tab-list button.active {
      color: var(--text);
      background: radial-gradient(circle at top, rgba(56,189,248,0.4), rgba(15,23,42,0.5));
      box-shadow: 0 0 0 1px rgba(56,189,248,0.65), 0 10px 20px rgba(15,23,42,0.9);
      transform: translateY(-1px);
    }

    .tab-list button.active span.count-pill {
      border-color: rgba(56, 189, 248, 0.7);
      color: var(--accent-strong);
    }

    .tab-meta {
      font-size: 0.75rem;
      color: var(--muted);
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.25);
    }

    .filter-bar {
      margin-top: -4px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--muted);
      padding: 4px 4px 0;
    }

    .filter-label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.72rem;
      color: rgba(148, 163, 184, 0.9);
    }

    .filter-select {
      min-width: 200px;
      max-width: 260px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    .filter-select:focus {
      border-color: rgba(56, 189, 248, 0.8);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5), 0 0 0 6px rgba(56, 189, 248, 0.25);
      background: rgba(15, 23, 42, 1);
    }

    .sessions-wrapper {
      margin-top: 4px;
      padding: 10px 2px 0;
      border-top: 1px solid rgba(30, 64, 175, 0.5);
      max-height: calc(100vh - 230px);
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(148,163,184,0.6) transparent;
    }

    .sessions-wrapper::-webkit-scrollbar {
      width: 8px;
    }

    .sessions-wrapper::-webkit-scrollbar-track {
      background: transparent;
    }

    .sessions-wrapper::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.55);
      border-radius: 999px;
    }

    .session-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 12px;
    }

    .session-card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.08), transparent 50%),
                  radial-gradient(circle at bottom right, rgba(15,118,110,0.2), rgba(15,23,42,0.95));
      border-radius: var(--radius-lg);
      padding: 14px 14px 12px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.85);
      cursor: pointer;
    }

    .session-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(
        circle at top,
        rgba(56,189,248,0.15),
        transparent 65%
      );
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }

    .session-card:hover::before {
      opacity: 1;
    }

    .session-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }

    .session-title {
      font-size: 0.98rem;
      font-weight: 600;
      line-height: 1.25;
    }

    .session-id-pill {
      font-size: 0.65rem;
      padding: 2px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }

    .session-meta {
      font-size: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 3px;
      color: var(--muted);
    }

    .session-meta-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .meta-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: rgba(148,163,184,0.9);
    }

    .meta-location {
      font-weight: 500;
      color: var(--accent);
    }

    .meta-time {
      font-weight: 500;
      color: var(--text);
    }

    .session-description {
      font-size: 0.8rem;
      line-height: 1.45;
      color: var(--muted);
      margin-top: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 4;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .session-footer {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.75rem;
    }

    .saved-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: var(--accent-soft);
      color: var(--accent-strong);
      font-size: 0.72rem;
      font-weight: 500;
    }

    .saved-badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent-strong);
      box-shadow: 0 0 0 5px rgba(56,189,248,0.4);
    }

    .save-button {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      font-size: 0.78rem;
      font-weight: 500;
      padding: 6px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background 0.18s ease, transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    }

    .save-button span.icon {
      font-size: 0.9rem;
    }

    .save-button:hover {
      background: rgba(15, 23, 42, 1);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
      border-color: var(--accent-strong);
    }

    .save-button.saved {
      background: var(--accent-soft);
      border-color: rgba(56, 189, 248, 0.75);
      color: var(--accent-strong);
      box-shadow: 0 10px 26px rgba(56, 189, 248, 0.35);
    }

    .save-button.saved:hover {
      background: rgba(15, 23, 42, 0.96);
      color: var(--danger);
      border-color: rgba(248, 113, 113, 0.8);
      box-shadow: 0 10px 26px rgba(248, 113, 113, 0.4);
    }

    .empty-state {
      padding: 40px 14px 24px;
      text-align: center;
      color: var(--muted);
    }

    .empty-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text);
    }

    .empty-sub {
      font-size: 0.8rem;
    }

    .empty-sub span {
      color: var(--accent);
      font-weight: 500;
    }

    .error-banner {
      margin-top: 6px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(248, 113, 113, 0.7);
      background: radial-gradient(circle at top, rgba(248,113,113,0.2), rgba(15,23,42,0.96));
      font-size: 0.8rem;
      color: #fecaca;
    }

    .error-banner strong {
      color: #fee2e2;
    }

    /* ===== Detail overlay / modal ===== */

    .detail-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 100;
    }

    .detail-overlay.open {
      display: flex;
    }

    .detail-dialog {
      max-width: 640px;
      width: 100%;
      background: radial-gradient(circle at top, rgba(15,23,42,1), rgba(2,6,23,0.98));
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 24px 60px rgba(15,23,42,0.95);
      padding: 18px 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .detail-title {
      font-size: 1.05rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .detail-id-pill {
      font-size: 0.7rem;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--muted);
      white-space: nowrap;
    }

    .detail-close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15,23,42,0.9);
      width: 28px;
      height: 28px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      transition: background 0.16s ease, transform 0.16s ease, box-shadow 0.16s ease, color 0.16s ease;
    }

    .detail-close-btn:hover {
      background: rgba(15,23,42,1);
      color: var(--text);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15,23,42,0.9);
    }

    .detail-meta {
      font-size: 0.8rem;
      color: var(--muted);
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 4px;
    }

    .detail-meta-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .detail-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(148,163,184,0.95);
    }

    .detail-location {
      font-weight: 500;
      color: var(--accent);
    }

    .detail-time {
      font-weight: 500;
      color: var(--text);
    }

    .detail-body {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px solid rgba(30, 64, 175, 0.6);
      max-height: 260px;
      overflow-y: auto;
      font-size: 0.86rem;
      line-height: 1.6;
      color: var(--text);
      scrollbar-width: thin;
      scrollbar-color: rgba(148,163,184,0.6) transparent;
    }

    .detail-body::-webkit-scrollbar {
      width: 8px;
    }

    .detail-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .detail-body::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.55);
      border-radius: 999px;
    }

    .detail-footer {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 0.78rem;
      flex-wrap: wrap;
    }

    .detail-status-pill {
      border-radius: var(--radius-pill);
      padding: 4px 10px;
      border: 1px solid rgba(148,163,184,0.5);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--muted);
    }

    .detail-status-pill.saved {
      border-color: rgba(56,189,248,0.7);
      color: var(--accent-strong);
      background: var(--accent-soft);
    }

    @media (max-width: 640px) {
      body {
        padding: 16px;
      }

      .app-shell {
        padding: 16px 14px 12px;
      }

      .sessions-wrapper {
        max-height: none;
      }

      .sessions-wrapper::-webkit-scrollbar {
        width: 6px;
      }

      .detail-dialog {
        padding: 16px 14px 14px;
      }

      .filter-bar {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="title-block">
        <div class="logo-pill">
          <div class="logo-letter">C</div>
        </div>
        <div>
          <h1>
            <span id="app-title">Conference Session Saver</span>
            <span class="accent-dot"></span>
          </h1>
          <div class="subtitle">
            Quickly bookmark sessions you care about and keep your schedule tidy.
          </div>
        </div>
      </div>
      <div>
        <div class="badges">
          <div class="badge">
            <span>‚ö°</span><span><strong>Offline-friendly</strong> ‚Ä¢ localStorage</span>
          </div>
          <div class="badge">
            <span>üìÑ</span><span>JSON-driven schedule</span>
          </div>
        </div>
      </div>
    </header>

    <section class="tabs-container">
      <div class="tab-list" role="tablist" aria-label="Session filters">
        <button id="tab-saved" class="active" role="tab" aria-selected="true" data-tab="saved">
          ‚≠ê Saved
          <span class="count-pill" id="count-saved">0</span>
        </button>
        <button id="tab-all" role="tab" aria-selected="false" data-tab="all">
          üìö All Sessions
          <span class="count-pill" id="count-all">0</span>
        </button>
      </div>
      <div class="tab-meta">
        <span class="status-dot"></span>
        <span id="status-text">Loading sessions‚Ä¶</span>
      </div>
    </section>

    <!-- Location filter bar -->
    <section class="filter-bar">
      <span class="filter-label">Location</span>
      <select id="location-filter" class="filter-select">
        <option value="__all">All locations</option>
      </select>
    </section>

    <div id="error-banner" class="error-banner" style="display:none;"></div>

    <section class="sessions-wrapper">
      <div id="sessions-container" class="session-list" aria-live="polite"></div>
      <div id="empty-state" class="empty-state" style="display:none;">
        <div class="empty-title">No sessions found for this view.</div>
        <div class="empty-sub">
          Try a different <span>location</span>, switch to <span>All Sessions</span> or check your <span>sessions.json</span> file.
        </div>
      </div>
    </section>
  </div>

  <!-- Detail overlay / modal -->
  <div id="detail-overlay" class="detail-overlay" aria-hidden="true">
    <div class="detail-dialog" role="dialog" aria-modal="true" aria-labelledby="detail-title">
      <button id="detail-close-btn" class="detail-close-btn" type="button" aria-label="Close details">‚úï</button>
      <div class="detail-header">
        <h2 id="detail-title" class="detail-title"></h2>
        <div id="detail-id-pill" class="detail-id-pill"></div>
      </div>
      <div class="detail-meta">
        <div class="detail-meta-row">
          <span class="detail-label">Location</span>
          <span id="detail-location" class="detail-location"></span>
        </div>
        <div class="detail-meta-row">
          <span class="detail-label">Time</span>
          <span id="detail-time" class="detail-time"></span>
        </div>
      </div>
      <div id="detail-body" class="detail-body"></div>
      <div class="detail-footer">
        <div id="detail-status" class="detail-status-pill">
          <span>Session status</span>
        </div>
        <button id="detail-save-btn" class="save-button" type="button">
          <span class="icon">Ôºã</span>
          <span>Save session</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const SESSIONS_JSON_URL = 'sessions.json';
      const STORAGE_KEY = 'conference_saved_session_ids';
      const LOCATION_ALL = '__all';

      let allSessions = [];
      let savedSessionIds = new Set();
      let currentTab = 'saved';
      let currentLocationFilter = LOCATION_ALL;
      let openDetailSessionId = null;
      let appTitle = 'Conference Session Saver';

      const sessionsContainer = document.getElementById('sessions-container');
      const emptyState = document.getElementById('empty-state');
      const errorBanner = document.getElementById('error-banner');

      const tabSaved = document.getElementById('tab-saved');
      const tabAll = document.getElementById('tab-all');
      const countSaved = document.getElementById('count-saved');
      const countAll = document.getElementById('count-all');
      const statusText = document.getElementById('status-text');
      const locationFilterSelect = document.getElementById('location-filter');
      const appTitleEl = document.getElementById('app-title');

      // Detail elements
      const detailOverlay = document.getElementById('detail-overlay');
      const detailCloseBtn = document.getElementById('detail-close-btn');
      const detailTitle = document.getElementById('detail-title');
      const detailIdPill = document.getElementById('detail-id-pill');
      const detailLocation = document.getElementById('detail-location');
      const detailTime = document.getElementById('detail-time');
      const detailBody = document.getElementById('detail-body');
      const detailStatus = document.getElementById('detail-status');
      const detailSaveBtn = document.getElementById('detail-save-btn');

      function loadSavedIds() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            savedSessionIds = new Set(parsed);
          }
        } catch (err) {
          console.warn('Failed to parse saved session IDs from localStorage:', err);
        }
      }

      function persistSavedIds() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(savedSessionIds)));
        } catch (err) {
          console.warn('Failed to save session IDs to localStorage:', err);
        }
      }

      function formatDateRange(start, end) {
        const startDate = new Date(start);
        const endDate = new Date(end);

        if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
          return 'Unknown time';
        }

        const dateFormatter = new Intl.DateTimeFormat(undefined, {
          weekday: 'short',
          month: 'short',
          day: 'numeric'
        });

        const timeFormatter = new Intl.DateTimeFormat(undefined, {
          hour: '2-digit',
          minute: '2-digit'
        });

        const sameDay =
          startDate.getFullYear() === endDate.getFullYear() &&
          startDate.getMonth() === endDate.getMonth() &&
          startDate.getDate() === endDate.getDate();

        if (sameDay) {
          return `${dateFormatter.format(startDate)} ¬∑ ${timeFormatter.format(startDate)} ‚Äì ${timeFormatter.format(endDate)}`;
        } else {
          return `${dateFormatter.format(startDate)} ${timeFormatter.format(startDate)} ‚Äì ${dateFormatter.format(endDate)} ${timeFormatter.format(endDate)}`;
        }
      }

      function buildLocationFilterOptions() {
        if (!locationFilterSelect) return;

        const locations = Array.from(
          new Set(
            allSessions
              .map(s => (s.location || '').trim())
              .filter(Boolean)
          )
        ).sort((a, b) => a.localeCompare(b));

        locationFilterSelect.innerHTML = '<option value="__all">All locations</option>';
        locations.forEach(loc => {
          const opt = document.createElement('option');
          opt.value = loc;
          opt.textContent = loc;
          locationFilterSelect.appendChild(opt);
        });
      }

      function render() {
        sessionsContainer.innerHTML = '';

        const baseSessions =
          currentTab === 'saved'
            ? allSessions.filter(s => savedSessionIds.has(String(s.id)))
            : allSessions.slice();

        let sessionsToShow = baseSessions;
        if (currentLocationFilter !== LOCATION_ALL) {
          const target = currentLocationFilter.toLowerCase();
          sessionsToShow = sessionsToShow.filter(s => (s.location || '').toLowerCase() === target);
        }

        const visibleCount = sessionsToShow.length;
        const totalAll = allSessions.length;
        const totalSaved = savedSessionIds.size;

        countAll.textContent = totalAll.toString();
        countSaved.textContent = totalSaved.toString();

        if (visibleCount === 0) {
          sessionsContainer.style.display = 'none';
          emptyState.style.display = 'block';
        } else {
          sessionsContainer.style.display = 'grid';
          emptyState.style.display = 'none';
        }

        sessionsToShow
          .slice()
          .sort((a, b) => new Date(a.startTime) - new Date(b.startTime))
          .forEach(session => {
            const isSaved = savedSessionIds.has(String(session.id));
            const card = document.createElement('article');
            card.className = 'session-card';
            card.dataset.sessionId = session.id;

            card.innerHTML = `
              <div class="session-header">
                <div>
                  <div class="session-title">${escapeHtml(session.title || '')}</div>
                  <div class="session-meta">
                    <div class="session-meta-row">
                      <span class="meta-label">Location</span>
                      <span class="meta-location">${escapeHtml(session.location || 'TBA')}</span>
                    </div>
                    <div class="session-meta-row">
                      <span class="meta-label">Time</span>
                      <span class="meta-time">${formatDateRange(session.startTime, session.endTime)}</span>
                    </div>
                  </div>
                </div>
                <div class="session-id-pill">ID: ${escapeHtml(String(session.id))}</div>
              </div>
              <p class="session-description">${escapeHtml(session.description || '')}</p>
              <div class="session-footer">
                ${isSaved ? `
                  <div class="saved-badge">
                    <span class="saved-badge-dot"></span>
                    Saved to your list
                  </div>
                ` : `<span></span>`}
                <button
                  class="save-button ${isSaved ? 'saved' : ''}"
                  data-session-id="${escapeHtml(String(session.id))}"
                  type="button"
                >
                  <span class="icon">${isSaved ? '‚úì' : 'Ôºã'}</span>
                  <span>${isSaved ? 'Remove' : 'Save session'}</span>
                </button>
              </div>
            `;

            sessionsContainer.appendChild(card);
          });

        if (totalAll > 0) {
          const filterText = currentLocationFilter !== LOCATION_ALL ? ` in ${currentLocationFilter}` : '';
          if (currentTab === 'saved') {
            if (!totalSaved) {
              statusText.textContent = 'You have not saved any sessions yet.';
            } else if (currentLocationFilter !== LOCATION_ALL) {
              statusText.textContent = `Showing ${visibleCount} of ${totalSaved} saved session${totalSaved === 1 ? '' : 's'}${filterText}.`;
            } else {
              statusText.textContent = `Showing ${visibleCount} saved session${visibleCount === 1 ? '' : 's'}.`;
            }
          } else {
            if (currentLocationFilter !== LOCATION_ALL) {
              statusText.textContent = `Showing ${visibleCount} of ${totalAll} session${totalAll === 1 ? '' : 's'}${filterText}.`;
            } else {
              statusText.textContent = `Showing all ${totalAll} session${totalAll === 1 ? '' : 's'}.`;
            }
          }
        }

        if (openDetailSessionId) {
          updateDetailSaveControls(openDetailSessionId);
        }
      }

      function escapeHtml(str) {
        return String(str)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#039;');
      }

      function toggleSave(sessionId) {
        const idStr = String(sessionId);
        if (savedSessionIds.has(idStr)) {
          savedSessionIds.delete(idStr);
        } else {
          savedSessionIds.add(idStr);
        }
        persistSavedIds();
        render();
      }

      function setTab(tabName) {
        currentTab = tabName;
        if (tabName === 'saved') {
          tabSaved.classList.add('active');
          tabSaved.setAttribute('aria-selected', 'true');
          tabAll.classList.remove('active');
          tabAll.setAttribute('aria-selected', 'false');
        } else {
          tabAll.classList.add('active');
          tabAll.setAttribute('aria-selected', 'true');
          tabSaved.classList.remove('active');
          tabSaved.setAttribute('aria-selected', 'false');
        }
        render();
      }

      function showError(message) {
        errorBanner.style.display = 'block';
        errorBanner.innerHTML = `<strong>Load error:</strong> ${message}`;
      }

      function clearError() {
        errorBanner.style.display = 'none';
        errorBanner.textContent = '';
      }

      function findSessionById(sessionId) {
        const idStr = String(sessionId);
        return allSessions.find(s => String(s.id) === idStr) || null;
      }

      // ===== Detail overlay functions =====

      function updateDetailSaveControls(sessionId) {
        const isSaved = savedSessionIds.has(String(sessionId));
        detailStatus.classList.toggle('saved', isSaved);
        detailStatus.innerHTML = isSaved
          ? '<span>‚≠ê Saved to your list</span>'
          : '<span>Not saved yet</span>';

        detailSaveBtn.classList.toggle('saved', isSaved);
        detailSaveBtn.querySelector('.icon').textContent = isSaved ? '‚úì' : 'Ôºã';
        detailSaveBtn.querySelector('span:nth-child(2)').textContent = isSaved ? 'Remove from saved' : 'Save session';
      }

      function openDetail(sessionId) {
        const session = findSessionById(sessionId);
        if (!session) return;

        openDetailSessionId = String(session.id);

        detailTitle.textContent = session.title || '';
        detailIdPill.textContent = `ID: ${session.id}`;
        detailLocation.textContent = session.location || 'TBA';
        detailTime.textContent = formatDateRange(session.startTime, session.endTime);
        detailBody.textContent = session.description || 'No description provided.';

        updateDetailSaveControls(session.id);

        detailOverlay.classList.add('open');
        detailOverlay.setAttribute('aria-hidden', 'false');
      }

      function closeDetail() {
        openDetailSessionId = null;
        detailOverlay.classList.remove('open');
        detailOverlay.setAttribute('aria-hidden', 'true');
      }

      function initInteractions() {
        tabSaved.addEventListener('click', () => setTab('saved'));
        tabAll.addEventListener('click', () => setTab('all'));

        locationFilterSelect.addEventListener('change', () => {
          currentLocationFilter = locationFilterSelect.value;
          render();
        });

        sessionsContainer.addEventListener('click', (event) => {
          const target = event.target;
          if (!target) return;

          const button = target.closest('.save-button');
          if (button && button.dataset.sessionId) {
            event.stopPropagation();
            toggleSave(button.dataset.sessionId);
            return;
          }

          const card = target.closest('.session-card');
          if (card && card.dataset.sessionId) {
            openDetail(card.dataset.sessionId);
          }
        });

        detailCloseBtn.addEventListener('click', () => {
          closeDetail();
        });

        detailOverlay.addEventListener('click', (event) => {
          if (event.target === detailOverlay) {
            closeDetail();
          }
        });

        detailSaveBtn.addEventListener('click', () => {
          if (!openDetailSessionId) return;
          toggleSave(openDetailSessionId);
        });

        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && detailOverlay.classList.contains('open')) {
            closeDetail();
          }
        });
      }

      async function fetchSessions() {
        try {
          clearError();
          statusText.textContent = 'Loading sessions‚Ä¶';

          const response = await fetch(SESSIONS_JSON_URL, { cache: 'no-store' });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status} ‚Äì ${response.statusText}`);
          }

          const data = await response.json();

          // Support the new shape: { title, sessions: [...] }
          if (data && typeof data === 'object' && !Array.isArray(data)) {
            if (typeof data.title === 'string' && data.title.trim()) {
              appTitle = data.title.trim();
            }
            allSessions = Array.isArray(data.sessions) ? data.sessions : [];
          } else if (Array.isArray(data)) {
            // Backwards compatibility: plain array of sessions
            allSessions = data;
          } else {
            allSessions = [];
          }

          // Apply title to document & header
          document.title = appTitle;
          if (appTitleEl) {
            appTitleEl.textContent = appTitle;
          }

          buildLocationFilterOptions();

          statusText.textContent =
            allSessions.length > 0
              ? `Loaded ${allSessions.length} session${allSessions.length === 1 ? '' : 's'}.`
              : 'No sessions found in JSON.';

          render();
        } catch (err) {
          console.error('Failed to load sessions.json:', err);
          showError('Could not load sessions.json. Make sure it is hosted next to index.html and accessible.');
          statusText.textContent = 'Failed to load sessions.';
        }
      }

      function init() {
        loadSavedIds();
        initInteractions();
        fetchSessions();
      }

      document.addEventListener('DOMContentLoaded', init);
    })();
  </script>
</body>
</html>
